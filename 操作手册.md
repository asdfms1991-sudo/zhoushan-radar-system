# 舟山定海渔港雷达监控系统 V2.0
## 操作手册

---

## 目录

1. 系统概述
2. 部署环境
3. 硬件连接
4. 软件部署
5. 配置说明
6. 使用说明
7. 故障排查
8. 技术支持
9. 部署检查清单

---

## 1. 系统概述

本系统用于舟山定海渔港的海岸雷达 surveillance，实现：
- 雷达目标检测与跟踪
- AIS船舶识别
- 雷达+AIS目标融合
- Kalman滤波平滑
- 轨迹记录与预测
- Web实时显示

---

## 2. 部署环境

### 硬件要求

| 项目 | 最低配置 | 推荐配置 |
|------|----------|----------|
| CPU | Intel i5 / AMD Ryzen 5 | Intel i7 / AMD Ryzen 7 |
| 内存 | 8GB | 16GB |
| 存储 | 50GB SSD | 100GB SSD |
| 网络 | 100Mbps | 1000Mbps |
| 操作系统 | Windows 10/11 或 Ubuntu 20.04 | Windows 11 |

### 软件依赖

```
Python 3.11+
├── flask
├── flask-socketio
├── pynmea2
├── pyserial
├── pyais
├── numpy
└── websocket-client
```

---

## 3. 硬件连接

### 雷达连接（Simrad Halo3000）

```
┌─────────────────┐         ┌──────────────────┐
│  Simrad Halo3000 │────────▶│   雷达服务器     │
│    雷达主机      │  网线    │   (Windows PC)   │
└─────────────────┘         └──────────────────┘
       ▲
       │ NMEA TTM / UDP
       │
┌──────┴──────┐
│  AIS接收机   │
└─────────────┘
```

### 连接参数

| 设备 | 参数 | 默认值 |
|------|------|--------|
| **雷达** | IP | 192.168.1.100 |
| **雷达** | 端口 | 2000 |
| **雷达** | 协议 | TCP |
| **AIS** | 串口 | COM3 |
| **AIS** | 波特率 | 38400 |

### 网络拓扑

```
internet
   │
   ▼
┌────────────────┐
│  监控中心网络   │
│  192.168.1.x  │
└───────┬────────┘
        │
    ┌───┴───┐
    │       │
192.168.1.100  192.168.1.101
(雷达)        (服务器)
```

---

## 4. 软件部署

### 步骤1：安装Python

```bash
# Windows
# 下载 https://www.python.org/downloads/
# 勾选 "Add Python to PATH"

# 验证
python --version
```

### 步骤2：创建项目目录

```bash
# 创建目录
mkdir radar_system
cd radar_system

# 复制所有文件到此处
```

### 步骤3：安装依赖

```bash
# 方法1：使用requirements.txt
pip install -r requirements.txt

# 方法2：手动安装
pip install flask flask-socketio pynmea2 pyserial pyais numpy
```

### 步骤4：配置网络参数

编辑 `config/config.json`：

```json
{
    "radar": {
        "connection": {
            "ip": "192.168.1.100",   // 雷达IP地址
            "port": 2000,            // 雷达端口
            "protocol": "tcp"
        }
    },
    "ais": {
        "connection": {
            "port": "COM3",          // Windows: COM3, Linux: /dev/ttyUSB0
            "baudrate": 38400
        }
    }
}
```

### 步骤5：启动系统

```bash
# 正常启动（连接真实雷达）
python main.py

# 模拟器模式（测试用）
python main.py --simulator
```

### 步骤6：访问Web界面

打开浏览器访问：
```
http://localhost:8081
```

---

## 5. 配置说明

### 完整配置项

```json
{
    "system": {
        "name": "舟山定海渔港雷达监控系统",
        "version": "2.0.0",
        "log_level": "INFO"
    },
    "radar": {
        "enabled": true,
        "type": "simrad_halo3000",
        "connection": {
            "method": "network",
            "ip": "192.168.1.100",
            "port": 2000,
            "protocol": "tcp",
            "timeout": 30
        },
        "origin": {
            "lon": 122.107,
            "lat": 30.017
        }
    },
    "ais": {
        "enabled": true,
        "connection": {
            "method": "serial",
            "port": "COM3",
            "baudrate": 38400
        }
    },
    "fusion": {
        "enabled": true,
        "association_distance_m": 100,
        "kalman": {
            "process_noise": 0.1,
            "measurement_noise": 1.0
        },
        "cfar": {
            "guard_cells": 2,
            "ref_cells": 16,
            "p_fa": 0.0001
        },
        "clutter": {
            "min_speed": 0.5,
            "max_speed": 50.0
        },
        "storage": {
            "enabled": true,
            "path": "data/trajectories"
        }
    },
    "output": {
        "http": {
            "enabled": true,
            "port": 8081
        }
    }
}
```

---

## 6. 使用说明

### 启动系统

```bash
# 正常模式（连接真实设备）
python main.py

# 模拟器模式（离线测试）
python main.py --simulator
```

### 常用命令

| 命令 | 说明 |
|------|------|
| `python main.py` | 正常启动 |
| `python main.py --simulator` | 模拟器模式 |
| `python main.py --config custom.json` | 指定配置文件 |
| `python check_code.py` | 代码质量检查 |

### Web界面功能

| 功能 | 说明 |
|------|------|
| 实时显示 | 显示雷达目标和AIS目标 |
| 轨迹预测 | 显示30秒后的预测位置 |
| 目标列表 | 显示所有目标的详细信息 |

---

## 7. 故障排查

### 常见问题

| 问题 | 原因 | 解决方法 |
|------|------|----------|
| 雷达连接失败 | IP/端口错误 | 检查config.json中的IP和端口 |
| AIS无数据 | 串口错误 | 检查COM口是否正确 |
| Web无法访问 | 端口被占用 | 检查8081端口是否被占用 |
| 目标不显示 | 防火墙阻止 | 关闭防火墙或开放端口 |

### 网络检测

```bash
# 测试雷达连接
telnet 192.168.1.100 2000

# 测试端口
netstat -an | grep 8081

# 查看日志
tail -f logs/radar_system.log
```

### 日志位置

- 主日志：`logs/radar_system.log`
- 轨迹数据：`data/trajectories/`

---

## 8. 技术支持

如有问题，请联系：
- 维护人员：XXX
- 电话：XXX-XXXXXXX
- 邮箱：XXX@example.com

---

## 9. 部署检查清单

### 部署前检查

| # | 检查项 | 检查方法 |
|---|--------|----------|
| 1 | Python已安装 | `python --version` |
| 2 | 依赖已安装 | `pip list` |
| 3 | 配置文件正确 | 确认IP/端口 |
| 4 | 网络畅通 | `ping 192.168.1.100` |
| 5 | 端口可用 | `netstat -an \| findstr 8081` |

### Windows快速检查

```cmd
:: 检查Python
python --version

:: 检查端口占用
netstat -ano | findstr :8081

:: 检查网络连接
ping 192.168.1.100

:: 查看COM口
mode
```

### 首次部署步骤

```bash
# 1. 安装Python 3.11+
# 2. 复制项目文件
# 3. 安装依赖：pip install -r requirements.txt
# 4. 修改config/config.json中的IP和端口
# 5. 运行测试：python main.py --simulator
# 6. 确认Web访问正常
# 7. 停止测试，改为正式运行
```

### 坐标说明

| 位置 | 经度 | 纬度 | 说明 |
|------|------|------|------|
| 舟山定海 | 122.107 | 30.017 | 默认值，需根据实际调整 |

**可通过Google Maps确认实际坐标：**

---

**版本：V2.0.0**
**更新日期：2026-02-24**

# 雷达系统开发文档

> 版本: V2.0
> 更新日期: 2026-02-24

---

## 目录

1. [系统架构](#1-系统架构)
2. [核心模块](#2-核心模块)
3. [算法说明](#3-算法说明)
4. [配置说明](#4-配置说明)
5. [使用指南](#5-使用指南)
6. [API接口](#6-api接口)

---

## 1. 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                      主程序 (main.py)                       │
├─────────────────────────────────────────────────────────────┤
│  数据源层          处理层              输出层              │
│  ─────────        ─────────          ──────             │
│  雷达  →  CFAR检测  →  目标融合  →  轨迹管理  →  API    │
│  AIS  →  杂波过滤  →  Kalman   →  存储      →  Web    │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 核心模块

| 模块 | 文件 | 功能 |
|------|------|------|
| radar_parser.py | 雷达数据解析 | NMEA TTM |
| ais_parser.py | AIS解析 | AIS消息解码 |
| fusion.py | 目标融合 | 雷达+AIS融合 |
| advanced_tracker.py | 跟踪算法 | KF/EKF/UKF/PF |
| trajectory.py | 轨迹管理 | 轨迹记录/预测 |
| cfar_filter.py | CFAR检测 | 目标检测 |
| weather_config.py | 天气配置 | 4种天气模式 |
| multi_radar_fusion.py | 多雷达融合 | 多雷达数据融合 |
| cctv_linkage.py | CCTV联动 | CCTV接口预留 |
| alert.py | 告警 | 异常检测 |
| classifier.py | 目标分类 | 船型分类 |
| simulator.py | 模拟器 | 测试数据生成 |
| performance_monitor.py | 性能监控 | 实时指标 |

---

## 3. 算法说明

### 3.1 跟踪算法

| 算法 | 名称 | 精度 | 计算量 | 适用场景 |
|------|------|------|---------|----------|
| KF | 卡尔曼滤波 | 高 | 低 | 线性运动 |
| EKF | 扩展卡尔曼 | 高 | 中 | 非线性 |
| UKF | 无迹卡尔曼 | 更高 | 中高 | 精度要求高 |
| PF | 粒子滤波 | 最高 | 高 | 复杂场景 |

### 3.2 算法测试结果

```
算法         平均误差         标准差          最大误差        
--------------------------------------------------
UKF        0.4479       0.2484       1.0216      
EKF        0.4588       0.2463       1.4906      
KF         0.4689       0.2475       1.2929      
PF         2.1037       0.7979       5.1161      

推荐: UKF (误差最小)
```

### 3.3 天气模式

| 模式 | 海况 | CFAR阈值 | Kalman噪声 |
|------|------|----------|------------|
| calm | 0-1级 | 1e-3 | 0.05 |
| moderate | 2-3级 | 1e-4 | 0.1 |
| rough | 4-5级 | 1e-5 | 0.3 |
| storm | >5级 | 1e-6 | 0.5 |

---

## 4. 配置说明

### 4.1 主配置 (config.json)

```json
{
    "radar": {
        "connection": {
            "ip": "192.168.1.100",
            "port": 2000
        }
    },
    "ais": {
        "connection": {
            "port": "COM3",
            "baudrate": 38400
        }
    },
    "fusion": {
        "tracker": "UKF",
        "weather_mode": "moderate"
    }
}
```

### 4.2 跟踪器参数

```python
# 创建跟踪器
tracker = TrackerFactory.create('UKF', dt=1.0, q=0.1, r=1.0)

# 参数说明
# dt: 时间步长(秒)
# q: 过程噪声(越小跟踪越紧，越大跟踪越松)
# r: 测量噪声(越大滤波越平滑)
```

---

## 5. 使用指南

### 5.1 快速开始

```bash
# 安装依赖
pip install -r requirements.txt

# 模拟器模式测试
python main.py --simulator

# 正常模式
python main.py
```

### 5.2 算法测试

```python
from src.advanced_tracker import TrackerFactory, AlgorithmTester

# 列出所有算法
print(TrackerFactory.list_algorithms())  # ['KF', 'EKF', 'UKF', 'PF']

# 创建跟踪器
tracker = TrackerFactory.create('UKF')

# 处理目标
x, y = tracker.process(measurement_x, measurement_y)

# 获取状态
state = tracker.get_state()
print(state)  # {'x': ..., 'y': ..., 'vx': ..., 'vy': ..., 'speed': ...}
```

### 5.3 算法对比测试

```python
from src.advanced_tracker import AlgorithmTester

tester = AlgorithmTester()
results = tester.compare_all()

# 获取最佳算法
best_algo, best_result = tester.get_best()
print(f"最佳: {best_algo}, 误差: {best_result['mean_error']}")
```

### 5.4 模拟数据生成

```python
from src.simulator import ScenarioSimulator

scene = ScenarioSimulator()

# 简单场景
simple = scene.generate_simple_scene()

# 融合场景
fusion = scene.generate_fusion_scene()

# 天气场景
weather = scene.generate_weather_scene()
```

### 5.5 天气模式

```python
from src.weather_config import WeatherController, WeatherMode

controller = WeatherController()

# 手动模式
controller.set_mode(WeatherMode.ROUGH)

# 自动模式
controller.enable_auto()
controller.update_by_detection(clutter_level=0.8)
```

### 5.6 性能监控

```python
from src.performance_monitor import PerformanceMonitor

monitor = PerformanceMonitor()

# 处理开始
monitor.start_process()

# ... 处理逻辑 ...

# 处理结束
monitor.end_process(target_count=10)

# 获取统计
stats = monitor.get_all_stats()
health = monitor.get_health_status()
```

---

## 6. API接口

### 6.1 获取目标

```
GET /api/targets
```

返回:
```json
{
    "radar": [...],
    "ais": [...],
    "fused": [...],
    "stats": {...}
}
```

### 6.2 获取算法信息

```
GET /api/algorithms
```

返回:
```json
{
    "available": ["KF", "EKF", "UKF", "PF"],
    "current": "UKF"
}
```

### 6.3 切换算法

```
POST /api/algorithm
{
    "algorithm": "PF"
}
```

### 6.4 获取性能统计

```
GET /api/performance
```

返回:
```json
{
    "latency": {...},
    "throughput": {...},
    "memory": {...},
    "health": {...}
}
```

---

## 附录

### A. 文件清单

```
radar_system_v2/
├── main.py
├── config/
│   └── config.json
├── src/
│   ├── radar_parser.py
│   ├── ais_parser.py
│   ├── fusion.py
│   ├── advanced_tracker.py   # 跟踪算法
│   ├── trajectory.py
│   ├── cfar_filter.py
│   ├── weather_config.py     # 天气模式
│   ├── multi_radar_fusion.py
│   ├── cctv_linkage.py
│   ├── alert.py
│   ├── classifier.py
│   ├── simulator.py          # 模拟器
│   ├── performance_monitor.py # 性能监控
│   └── storage.py
├── web/
│   └── *.py
└── requirements.txt
```

---

**版本: V2.0**
